<% if Rails.env.production? && !is_admin_view? %>
    <script type='text/javascript'>
        var _sf_async_config = window.sf_async_config || {};
        /** CONFIGURATION START **/
        _sf_async_config.uid = <%= Rails.application.secrets.chartbeat_uid %>
        _sf_async_config.domain = '<%= Rails.application.config.domain %>';
        _sf_async_config.useCanonical = true;
        <% if @category %>
        _sf_async_config.sections = "<%= decode_html_entities @category.name.gsub('"', "\"") %>";
        <% end %>
        <% if @post %>
        _sf_async_config.authors = "<%= @post.author.try(:byline) %>";
        <% end %>
        _sf_async_config.title = "<%= raw decode_html_entities(yield(:title).gsub('"', "\"").gsub("| Van Winkle's", "").strip) %>";

        /** CONFIGURATION END **/
        (function() {
            function loadChartbeat() {
                window._sf_endpt = (new Date()).getTime();
                var e = document.createElement('script');
                e.setAttribute('language', 'javascript');
                e.setAttribute('type', 'text/javascript');
                e.setAttribute('src', '//static.chartbeat.com/js/chartbeat.js');
                document.body.appendChild(e);
            }
            var oldonload = window.onload;
            window.onload = (typeof window.onload != 'function') ?
                loadChartbeat : function() {
                    oldonload();
                    loadChartbeat();
                };
        })();
    </script>
<% end %>
